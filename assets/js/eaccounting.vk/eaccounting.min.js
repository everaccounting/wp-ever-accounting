window.eaccounting=window.eaccounting||{},jQuery.fn.serializeObject=function(){var e={},n=this.serializeArray();return jQuery.each(n,function(){e[this.name]!==undefined?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},jQuery.fn.serializeAssoc=function(){var o={};return $.each(this.serializeArray(),function(e,n){var t,a,c=n.name.match(/(.*?)\[(.*?)\]/);null!==c?(t=c[1],a=c[2],o[t]||(o[t]=[]),a.length||(a=o[t].length),o[t][a]?($.isArray(o[t][a])||(o[t][a]=[]),o[t][a].push(n.value)):o[t][a]=n.value):o[n.name]?($.isArray(o[n.name])||(o[n.name]=[]),o[n.name].push(n.value)):o[n.name]=n.value}),o},jQuery(function(o){o.fn.eaccounting_select2=function(e){return this.each(function(){new o.eaccounting_select2(this,e)})},o.eaccounting_select2=function(e,n){this.el=e,this.$el=o(e),this.placeholder=this.$el.attr("placeholder"),this.template=this.$el.attr("data-template"),this.nonce=this.$el.attr("data-nonce"),this.type=this.$el.attr("data-type"),this.creatable_text=this.$el.attr("data-text"),this.creatable=this.$el.is("[data-creatable]"),this.creatable=!0===this.creatable,this.ajax=this.$el.is("[data-ajax]"),this.ajax=!0===this.ajax,this.id=this.$el.attr("id"),!this.ajax||this.type&&this.nonce||(console.warn("ajax type defined without nonce and data type"),this.ajax=!1),this.creatable&&!this.template&&(console.warn("modal type defined without template"),this.creatable=!1);var a=this,t={};t.placeholder=this.placeholder,t.allowClear=!1,this.ajax&&(t.ajax={cache:!0,delay:500,url:eaccounting_i10n.ajaxurl,method:"POST",dataType:"json",data:function(e){return{action:"eaccounting_dropdown_search",nonce:a.nonce,type:a.type,search:e.term,page:e.page}},processResults:function(e,n){return n.page=n.page||1,{results:e.results,pagination:{more:e.pagination.more}}}});var c=o.extend({},t,n);return this.$el.select2(c),this.creatable&&a.template&&this.$el.on("select2:open",function(e){var n,t=o("#select2-"+a.id+"-results").closest(".select2-results");t.children(".ea-select2-footer").length||(n=o('<a href="#" class="ea-select2-footer"><span class="dashicons dashicons-plus"></span>'+a.creatable_text+"</a>").on("click",function(e){e.preventDefault(),a.$el.select2("close"),console.log(a.template),o(document).trigger("ea_trigger_creatable",[a.$el,a.template])}),t.append(n))}),this.$el},o(".ea-select2").eaccounting_select2()}),jQuery(function(a){jQuery.fn.ea_color_picker=function(){return this.each(function(){var t=this;a(t).iris({change:function(e,n){a(t).parent().find(".colorpickpreview").css({backgroundColor:n.color.toString()})},hide:!0,border:!0}).on("click focus",function(e){e.stopPropagation(),a(".iris-picker").hide(),a(t).closest("div").find(".iris-picker").show(),a(t).data("original-value",a(t).val())}).on("change",function(){a(t).is(".iris-error")&&(a(this).data("original-value").match(/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)?a(t).val(a(t).data("original-value")).change():a(t).val("").change())}),a("body").on("click",function(){a(".iris-picker").hide()})})},a(".ea-input-color").ea_color_picker()}),jQuery(function(n){n.eaccounting_redirect=function(e){if("object"==typeof e){if(!("redirect"in e))return;e=e.redirect}if(e){if(!(e=e.trim()))return!1;var n=navigator.userAgent.toLowerCase(),t=-1!==n.indexOf("msie"),a=parseInt(n.substr(4,2),10);if(t&&a<9){var c=document.createElement("a");return c.href=e,document.body.appendChild(c),c.click()}window.location.href=e}},n.fn.eaccounting_redirect=function(e){return new n.eaccounting_redirect(e)}}),jQuery(function(c){c.fn.eaccounting_creatable=function(e){return this.each(function(){new c.eaccounting_creatable(this,e)})},c.eaccounting_creatable=function(e,n){this.defaults={option:function(e){return{id:e.id,text:e.name}},template:undefined,onReady:undefined,onSubmit:undefined},this.el=e,this.$el=c(e),this.options=c.extend(this.defaults,n);var a=this;return this.block=function(){a.$el.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblock=function(){a.$el.unblock()},this.onError=function(e){console.warn(e),a.unblock()},this.init_plugins=function(){c(".ea-select2",this.$el).eaccounting_select2(),c(".ea-input-color").ea_color_picker()},this.handleSubmit=function(e,t){a.block(),t.disableSubmit(),"function"==typeof a.options.onSubmit&&a.options.onSubmit(a.$el,e,t),wp.ajax.send({data:e,success:function(e){var n=a.options.option(e.item);a.$el.eaccounting_select2({data:[n]}),a.$el.val(n.id).trigger("change"),c.eaccounting_notice(e.message,"success"),t.closeModal(),t.enableSubmit()},error:function(e){c.eaccounting_notice(e.message,"error"),t.enableSubmit()}})},this.handleModal=function(e,n,t){e.preventDefault(),n.is(a.$el)&&(e.preventDefault(),c(this).ea_backbone_modal({template:"ea-modal-"+t,onSubmit:a.handleSubmit,onReady:function(e,n){"function"==typeof a.options.onReady&&a.options.onReady(a.$el,n,a)}}))},this.init=function(){c(document).on("ea_trigger_creatable",a.handleModal).on("ea_backbone_modal_loaded",a.init_plugins)},this.init(),this}}),jQuery(function(a){a.fn.eaccounting_form=function(e){return this.each(function(){new a.eaccounting_form(this,e)})},a.eaccounting_form=function(e,n){var t={};t.el=e,t.$el=a(e),t.options=n,t.account_id=a("#account_id, #from_account_id",t.$el),t.currency_code=a("#currency_code",t.$el),t.amount=a("#amount, #opening_balance",t.$el),t.code=a("#code",t.$el),t.files=a(".ea-files-preview",t.$el),t.uploader=a(".ea-files-upload",t.$el),t.block=function(){t.$el.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},t.unblock=function(){t.$el.unblock()},t.onError=function(e){console.warn(e),t.unblock()},t.maskAmount=function(e){t.amount.inputmask("decimal",{alias:"numeric",groupSeparator:e.thousand_separator,autoGroup:!0,digits:e.precision,radixPoint:e.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:e.symbol,placeholder:"0.000",rightAlign:0})},t.getCurrency=function(e,n,t){wp.ajax.send("eaccounting_get_currency",{data:{code:e,_wpnonce:eaccounting_i10n.nonce.get_currency},success:n,error:t})},t.getAccount=function(e,n,t){wp.ajax.send("eaccounting_get_account",{data:{id:e,_wpnonce:eaccounting_i10n.nonce.get_account},success:n,error:t})},t.$el.on("submit",function(e){e.preventDefault(),t.block(),wp.ajax.send({data:t.$el.serializeObject(),success:function(e){t.unblock(),a.eaccounting_notice(e,"success"),a.eaccounting_redirect(e)},error:function(e){console.warn(e),t.unblock(),a.eaccounting_notice(e.message,"error")}})}),t.currency_code.on("change",function(){var e;t.amount.length&&(e=t.currency_code.val(),t.block(),t.getCurrency(e,function(e){t.maskAmount(e),t.unblock()},t.onError))}),t.account_id.on("change",function(){if(t.amount.length){var e=t.account_id.val(),n=parseInt(e,10);if(!n)return;t.block(),t.getAccount(n,function(e){t.getCurrency(e.currency_code,function(e){t.maskAmount(e),t.unblock()},t.onError)},t.onError)}}),t.code.on("change",function(){var e=t.code.val();if(console.log(e),!e)return!1;try{currency=eaccounting_i10n.global_currencies[e],a("#precision",t.$el).val(currency.precision).change(),a("#position",t.$el).val(currency.position).change(),a("#symbol",t.$el).val(currency.symbol).change(),a("#decimal_separator",t.$el).val(currency.decimal_separator).change(),a("#thousand_separator",t.$el).val(currency.thousand_separator).change()}catch(n){console.warn(n.message)}}),t.uploader.on("change",function(e){var n=new FormData;n.append("nonce",a(this).data("nonce")),n.append("upload",a(this)[0].files[0]),n.append("limit",a(this).data("limit")),n.append("action","eaccounting_upload_files"),t.block(),window.wp.ajax.send({type:"POST",data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(e){var n=a("<li>").append('<a href="'+e.url+'" target="_blank">'+e.name+"</a>");n.append('<a href="#" class="delete"><span class="dashicons dashicons-no-alt"></span></a>'),t.files.append(n),t.unblock()},error:function(e){t.unblock()}})}),t.account_id.trigger("change"),t.currency_code.trigger("change")}});