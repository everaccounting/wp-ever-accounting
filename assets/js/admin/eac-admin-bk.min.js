!function(n,e){"use strict";var t=function(e,a,t){e={action:"eac_get_account",account_id:e,_wpnonce:eac_admin_vars.get_account_nonce};n.post(eac_admin_vars.ajax_url,e,function(e){e.success&&!0===e.success&&a(e.data)}).always(function(){"function"==typeof t&&t()})},a=function(e,a,t){e={action:"eac_get_currency",currency_code:e,_wpnonce:eac_admin_vars.get_currency_nonce};n.post(eac_admin_vars.ajax_url,e,function(e){e.success&&!0===e.success&&a(e.data)}).always(function(){"function"==typeof t&&t()})},c=function(e,a,t){e={action:"eac_get_contact",contact_id:e,_wpnonce:eac_admin_vars.get_contact_nonce};n.post(eac_admin_vars.ajax_url,e,function(e){e.success&&!0===e.success&&a(e.data)}).always(function(){"function"==typeof t&&t()})},o=function(e,a){eac_admin_vars.base_currency;var a=a||{},t=a.decimal_separator,n=a.thousands_separator,c=a.precision,o=a.position,a=a.symbol;e.inputmask("decimal",{alias:"numeric",groupSeparator:n,autoGroup:!0,digits:c,radixPoint:t,digitsOptional:!1,allowMinus:!0,rightAlign:!1,prefix:"before"===o?a:"",suffix:"after"===o?a:""})},i=function(e){n('[form="'+e.attr("id")+'"]').removeAttr("disabled"),e.addClass("processing"),e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},r=function(e){n('[form="'+e.attr("id")+'"]').removeAttr("disabled"),e.removeClass("processing"),e.unblock()};function s(){n(e).trigger("init-select2"),n(e).trigger("init-datepicker"),n(e).trigger("init-tooltip"),n(e).trigger("init-form")}n(e).on("init-select2",function(){n(":input.eac-select2").filter(":not(.enhanced)").each(function(){var e={allowClear:n(this).data("allow_clear")&&!n(this).prop("multiple")||!0,placeholder:n(this).data("placeholder")||n(this).attr("placeholder")||"",minimumInputLength:n(this).data("minimum_input_length")?n(this).data("minimum_input_length"):0,ajax:{url:eac_admin_vars.ajax_url,dataType:"json",delay:250,method:"POST",data:function(e){return{term:e.term,action:n(this).data("action"),type:n(this).data("type"),_wpnonce:eac_admin_vars.search_nonce,exclude:n(this).data("exclude"),include:n(this).data("include"),limit:n(this).data("limit")}},processResults:function(e){return e.page=e.page||1,e},cache:!0}};n(this).data("action")||delete e.ajax,n(this).closest(".eac-form").length&&(e.dropdownParent=n(this).closest(".eac-form")),n(this).select2(e).addClass("enhanced")})}),n(e).on("init-form",function(){n('.eac-ajax-form :input[name="from_account_id"], .eac-ajax-form :input[name="account_id"]').on("change",function(){n(this);var a=n(this).closest("form"),e=n(this).val();if(!e)return n(':input[name="currency_code"]',a).val(eac_admin_vars.base_currency).trigger("change"),!1;i(a),t(e,function(e){n(':input[name="currency_code"]',a).val(e.currency_code).trigger("change")},function(){r(a)})}),n('.eac-ajax-form :input[name="currency_code"]').on("change",function(){var e=n(this).val(),t=n(this).closest("form");e&&(i(t),a(e,function(e){var a=n(':input[name="exchange_rate"]',t);o(n(':input[name="opening_balance"]',t),e),o(n(':input[name="amount"]',t),e),o(n(':input[name="price"]',t),e),e.code===eac_admin_vars.base_currency?(a.prop("readonly",!0),a.closest(".eac-form-field").addClass("display-none"),a.val(1),n(".eac-form-field__addon:last-child",a.closest(".eac-form-field")).text(eac_admin_vars.base_currency)):(a.prop("readonly",!1),a.closest(".eac-form-field").removeClass("display-none"),a.val(e.exchange_rate),n(".eac-form-field__addon:last-child",a.closest(".eac-form-field")).text(e.code))},function(){r(t)}))}),n('.eac-ajax-form :input[class*="eac-input-decimal"]').on("keyup change",function(){var e=(e=n(this).val()).replace(/[^0-9.]/g,"");n(this).val(e)}),n("form.eac-document-form a.edit_billing_address").on("click",function(e){e.preventDefault();e=n(this).closest("form");n(this).hasClass("display-none")||(n(this).toggleClass("display-none"),n(".billing-fields, .billing-data",e).toggleClass("display-none"),n(".load_billing_address",e).toggle())}),n('form.eac-document-form :input[name="contact_id"]').on("change",function(){var t=n(this).closest("form"),e=n(this).val();e&&(i(t),c(e,function(e){n.each(e,function(e,a){n(':input[name="billing_'+e+'"]',t).val(a).trigger("change")})},function(){r(t),t.trigger("update")}))})}),n(e).on("init-datepicker",function(){n(":input.eac-datepicker").filter(":not(.enhanced)").each(function(){n(this).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+0"}).addClass("enhanced")}),n("#eac_year_start_date").datepicker({dateFormat:"mm-dd",changeMonth:!0,changeYear:!1,yearRange:"-100:+0"})}),n(e).on("init-tooltip",function(){n(".eac-tooltip").tooltip({tooltipClass:"eac-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})}),n(e).on("eac-drawer-ready",function(){s()}),n(e).on("click",".eac-dropdown .eac-dropdown__button",function(e){e.preventDefault(),n(this).closest(".eac-dropdown").toggleClass("is--open")}),n(e).on("click",function(e){0===n(e.target).closest(".eac-dropdown__button").length&&n(".eac-dropdown").removeClass("is--open")}),n(e).on("change",'form.eac-document-form :input[class*="trigger-update"]',function(){n(this).closest("form").trigger("update")}),n(e).on("click","form.eac-document-form a.remove-line-item",function(e){e.preventDefault();e=n(this).closest("form");n(this).closest("tr").remove(),e.trigger("update")}),n(e).on("click","form.eac-document-form a.add-line-item",function(e){e.preventDefault();e=n(this).closest("form");n("#new-line-item",e).removeClass("display-none")}),n(e).on("click","form.eac-document-form a.calculate-totals",function(e){e.preventDefault();e=n(this).closest("form");e.data("hash",""),e.trigger("update")}),n(e).on("update","form.eac-document-form",function(){var e=n(this),t={},a=(n(":input",e).each(function(){var e=n(this).attr("name"),a=n(this).val();e&&(t[e]=a)}),JSON.stringify(t));a!==e.data("hash")&&(e.data("hash",a),e.trigger("block"),t.action="eac_calculate_invoice",e.load(eac_admin_vars.ajax_url,t,function(){e.trigger("unblock"),s()}).trigger("unblock"))}),n(e).ready(function(){s()})}(jQuery,(window,document));