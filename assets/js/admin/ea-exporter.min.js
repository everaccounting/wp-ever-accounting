jQuery(function(p){new(Backbone.View.extend({el:".ea-bulk-csv-exporter",events:{submit:"onSubmit"},initialize:function(){this.$submit_btn=p('input[type="submit"]',this.$el),_.bindAll(this,"onSubmit","process_step")},onSubmit:function(e){e.preventDefault(),this.$submit_btn.hasClass("disabled")||(this.$submit_btn.addClass("disabled"),this.$submit_btn.parent().append('<span class="spinner is-active"></span>'),p(".ea-batch-notice",this.$el).remove(),this.$el.append('<div class="ea-batch-notice"><div class="ea-batch-progress"><div></div></div></div>'),this.process_step(1,this.$el.serializeObject()))},process_step:function(e,s){var t=this,i=t.$el,n=i.find(".spinner"),a=i.find(".ea-batch-notice"),d=i.find(".ea-batch-progress");s.step=e,wp.ajax.send("eaccounting_do_ajax_export",{data:s,success:function(e){if(d.find("div").animate({width:e.percentage+"%"},50,function(){}),"done"===e.step)return t.$submit_btn.removeClass("disabled"),n.remove(),d.remove(),a.append(p('<div class="updated success"><p>'+e.message+"</p></div>")),window.location=e.url,!1;t.process_step(parseInt(e.step,10),s)},error:function(e){n.remove(),d.remove(),a.append(p('<div class="updated error"><p>'+e.message+"</p></div>")),t.$submit_btn.removeClass("disabled")}})}}))});