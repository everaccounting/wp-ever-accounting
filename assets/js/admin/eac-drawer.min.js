jQuery(function(n){"use strict";const t={appendTo:"body",focus:!0,autoResize:!0,zIndex:1e3,escClose:!0,overlayClose:!0,overlay:!0,onOpen:null,onReady:null,onClose:null,title:!1,target:!1,i18n:window.eac_drawer_i18n||{close:"Close",loading:"Loading...",error:"There was an error loading the drawer.",submit:"Submit"}};n.eac_drawer=function(e){const r=this;return this.options=n.extend({},t,e),this.open=function(){this.$drawer===undefined&&(this.$appendto=n(this.options.appendTo),this.$backdrop=n('<div class="eac-drawer__backdrop"></div>'),this.$container=n('<div class="eac-drawer__container"></div>'),this.$inner=n('<div class="eac-drawer__inner"></div>'),this.$wrapper=n('<div class="eac-drawer__wrapper"></div>'),this.$body=n('<div class="eac-drawer__body"></div>'),this.$loading=n('<div class="eac-drawer__loading">&nbsp;</div>'),this.$close=n('<button class="eac-drawer__close">&nbsp;</button>'),this.$title=n('<h3 class="eac-drawer__title"></h3>'),this.$header=n('<div class="eac-drawer__header"></div>'),this.$drawer=n('<div class="eac-drawer"></div>'),this.$root=n("<div>"),this.$wrapper.append(this.$header),this.$header.append(this.$title),this.$header.prepend(this.$close),this.$drawer.append(this.$backdrop),this.$drawer.append(this.$container),this.$container.append(this.$inner),this.$inner.append(this.$wrapper),this.$wrapper.append(this.$body),this.$body.append(this.$loading),this.options.overlay||this.$backdrop.remove(),this.options.title&&this.$title.text(this.options.title),this.$root.append(this.$drawer),this.$appendto.append(this.$root),this.$drawer.addClass("is--open"),this.$drawer.data("eac_drawer",this),n(document.body).hasClass("eac-drawer-open")||n(document.body).addClass("eac-drawer-open"),this.bindEvents(),n(document).trigger("eac_drawer_open",[this.$drawer,this]),"function"==typeof this.options.onOpen&&this.options.onOpen(),this.options.target?this.load(this.options.target,function(e){var t,o;r.focus(),n(document).trigger("eac_drawer_ready",[r.$drawer,r]),0<r.$body.find("form").length&&(t=(o=r.$body.find("form")).find('input[type="submit"]').val()||r.options.i18n.submit,o.attr("id")||o.attr("id","eac-drawer-form-"+Math.floor(1e5*Math.random())),o=o.attr("id"),r.$header.append('<button type="submit" form="'+o+'" class="eac-drawer__submit button button-primary">'+t+"</button>")),"function"==typeof r.options.onReady&&r.options.onReady(r.$drawer,r)}):console.error("No target was set for the drawer."))},this.load=function(e,i){if(e){var t;if(0===e.indexOf("#"))return 0===n(e).length?void console.error("The target id was not found in the current page."):(t=n(e).html(),this.$body.html(t),this.$loading.remove(),"function"==typeof i?i(t):void 0);try{this.$body.load(e,function(e,t,o){if(r.$loading.remove(),"success"!==t&&r.$body.html(o.statusText),"function"==typeof i)return i(e)})}catch(o){console.error(o)}}},this.bindEvents=function(){this.options.escClose&&n(document).on("keyup.eac_drawer",function(e){27===e.keyCode&&r.close()}),this.options.overlayClose&&this.options.overlay&&this.$backdrop.on("click.eac_drawer",function(e){r.close()}),this.$close.on("click.eac_drawer",function(e){e.preventDefault(),r.close()}),this.options.autoResize&&n(window).on("resize.eac_drawer orientationchange.eac_drawer",function(e){r.resize()})},this.unbindEvents=function(){n(document).off("keyup.eac_drawer"),this.$backdrop.off("click.eac_drawer"),this.$close.off("click.eac_drawer"),n(window).off("resize.eac_drawer orientationchange.eac_drawer")},this.focus=function(){var e,t=n(".eac-drawer.is--open");for(let e=t.length-1;0<=e;e--){var o=n(t[e]),i=100+e,r=e===t.length-1?0:-100*(t.length-e-1);o.css("z-index",i),o.css("transform","translateX("+r+"px)")}0<t.length&&((e=n(t[t.length-1])).focus(),e.find("input").first().focus())},this.resize=function(){console.log("resize")},this.updatePosition=function(){},this.close=function(){this.unbindEvents(),r.$drawer.remove(),this.$root.remove(),this.focus(),"function"==typeof this.options.onClose&&this.options.onClose(),n(document).trigger("eac_drawer_close",[r]),0===n(".eac-drawer").length&&n("body").removeClass("eac-drawer-open")},this.open(),r},n.fn.eac_drawer=function(e){return this.each(function(){new n.eac_drawer(e)})},n(document).on("click",'[rel~="eac_drawer"], a[href*="eac_get_html_response"]',function(e){e.preventDefault();var e=n(this),t=e.attr("href"),o=e.text(),o=e.attr("title")||o,e=e.data(),e=n.extend({},e,{target:t,title:o});n(this).eac_drawer(e)})});