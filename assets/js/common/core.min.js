!function(c,n,r){"use strict";const o={vars:n.eac_admin_vars||{},cache:{},fn:{getVar:function(e){return o.vars[e]||null},setVar:function(e,t){o.vars[e]=t},getCache:function(e,t){return(t=t||"default")in o.cache||(o.cache[t]={}),o.cache[t][e]},setCache:function(e,t,a){(a=a||"default")in o.cache||(o.cache[a]={}),o.cache[a][e]=t},removeCache:function(e,t){(t=t||"default")in o.cache&&delete o.cache[t][e]},flushCache:function(e){(e=e||"default")in o.cache&&delete o.cache[e]},ajax:async function(e,t,a={}){return t=t||"GET",c.ajax({url:a.url||o.vars.ajax_url,method:t,data:e,contentType:"application/json",headers:{"X-WP-Nonce":o.vars.nonce}})},getFormData:function(e){e=c(e);const a={};return c(":input",e).each(function(){var e=c(this).attr("name"),t=c(this).val();e&&(a[e]=t)}),a},blockForm:function(e){var e=c(e),t=c('[form="'+e.attr("id")+'"]');e.find(":input").prop("disabled",!0),e.find(":submit").attr("disabled","disabled"),t.attr("disabled","disabled"),e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},disableSubmit:function(e){var e=c(e),t=c('[form="'+e.attr("id")+'"]');e.find(":submit").attr("disabled","disabled"),t.attr("disabled","disabled")},enableSubmit:function(e){var e=c(e),t=c('[form="'+e.attr("id")+'"]');e.find(":submit").removeAttr("disabled"),t.removeAttr("disabled")},unblockForm:function(e){var e=c(e),t=c('[form="'+e.attr("id")+'"]');e.find(":input").prop("disabled",!1),e.find(":submit").removeAttr("disabled"),t.removeAttr("disabled"),e.unblock()},ajaxForm:function(a,n={}){const r=c(a);r.data("form_data",o.fn.getFormData(a)),r.on("submit",function(e){if(e.preventDefault(),o.fn.blockForm(a),"yes"===r.attr("locked"))return!1;r.attr("locked","yes");var e=o.fn.getFormData(a),t=r.attr("action")||o.vars.ajax_url;c.post(t,e,function(e){"function"==typeof n.onSuccess&&n.onSuccess(e),e.success&&(r.trigger("eac_form_submit_success",[e]),r.closest(".eac-drawer").length?r.closest(".eac-drawer").data("eac_drawer").close():o.fn.redirect(e))}).always(function(e){o.fn.unblockForm(a),o.fn.notify(e),r.removeAttr("locked")})})},notify:function(t,a){const n={appendTo:"body",stack:!1,customClass:!1,type:"success",offset:{from:"bottom",amount:50},align:"right",minWidth:250,maxWidth:450,delay:4e3,spacing:10};if("object"==typeof t){if("data"in t&&(a=t.success&&!0===t.success?"success":"error",t=t.data),!("message"in t))return;t=t.message}if(t){if(!(t=t.trim()))return!1;a=(a='<div class="eac-notification notice notice-'+(a||n.type)+" "+(n.customClass||"")+'">')+t+"</div>";let e=n.offset.amount;(n.stack?c(n.appendTo).find(".eac-notification"):c(".eac-notification")).each(function(){return e=Math.max(e,parseInt(c(this).css(n.offset.from))+this.offsetHeight+n.spacing)});t={position:"body"===n.appendTo?"fixed":"absolute",margin:0,"z-index":"9999",display:"none","min-width":n.minWidth,"max-width":n.maxWidth};t[n.offset.from]=e+"px";const r=c(a).css(t).appendTo(n.appendTo);switch(n.align){case"center":r.css({left:"50%","margin-left":"-"+r.outerWidth()/2+"px"});break;case"left":r.css("left","20px");break;default:r.css("right","20px")}return r.fadeIn?r.fadeIn():r.css({display:"block",opacity:1}),r.on("timeout",function(){r.remove()}),0<n.delay&&setTimeout(function(){r.trigger("timeout")},n.delay),r.click(function(){r.trigger("timeout")}),r}},redirect:function(e){if("object"==typeof e){if(!("redirect"in(e="data"in e?e.data:e)))return;e=e.redirect}var t,a;if(e)return!!(e=e.trim())&&(a=-1!==(t=navigator.userAgent.toLowerCase()).indexOf("msie"),t=parseInt(t.substr(4,2),10),a&&t<9?((a=r.createElement("a")).href=e,r.body.appendChild(a),a.click()):void(n.location.href=e))},formatMoney:function(e,t){if(void 0===e||!e)return"";void 0!==t&&t||(t=eac_admin_vars.base_currency_code);t=o.api.getCurrency(t);if(!t)return"";var a=t.symbol,n=t.decimal_separator,r=t.thousand_separator,c=t.decimal_places,t=t.position,c=(e=e.toFixed(c)).split(".");switch(c[0]=c[0].split(/(?=(?:\d{3})+$)/).join(r),e=c.join(n),t){case"before":e=a+e;break;case"after":e+=a}return e},unFormatMoney:function(r,e){if(void 0===r||!r)return"";e=e||o.fn.getVar("base_currency_code"),o.api.getCurrency(e).then(e=>{var t=e.symbol,a=e.decimal_separator||".",n=e.thousand_separator||",",e=e.precision||2;return r=(r=(r=(r=r.replace(t,"")).replace(new RegExp("[^0-9\\"+a+"\\"+n+"\\-\\+]","g"),"")).replace(n,"")).replace(a,"."),r=parseFloat(r).toFixed(e)})["catch"](e=>{o.fn.notice(e,"error")})},inputPrice:function(a,e,n={}){void 0!==e&&e||(e=o.fn.getVar("base_currency_code")),console.log("inputPrice",a,e,n),o.api.getCurrency(e).then(e=>{var t=e.position||"before",t=c.extend({alias:"numeric",groupSeparator:e.thousand_separator||",",autoGroup:!0,digits:e.decimal_places||2,radixPoint:e.decimal_separator||".",rightAlign:!1,digitsOptional:!1,allowMinus:!0,placeholder:"0",autoUnmask:!0,unmaskAsNumber:!0,prefix:"before"===t?e.symbol:"",suffix:"after"===t?e.symbol:""},n);c(a).inputmask("decimal",t)})},select2:function(e,t={}){if("undefined"==typeof c.fn.select2)console.warn("Select2 is not loaded.");else{const a=c(e);e={allowClear:a.data("allow_clear")&&!a.prop("multiple")||!0,placeholder:a.data("placeholder")||a.attr("placeholder")||"",minimumInputLength:a.data("minimum_input_length")?a.data("minimum_input_length"):0,ajax:{url:eac_admin_vars.ajax_url,dataType:"json",delay:250,method:"POST",data:function(e){return{term:e.term,action:a.data("action"),type:a.data("type"),_wpnonce:eac_admin_vars.search_nonce,exclude:a.data("exclude"),include:a.data("include"),limit:a.data("limit")}},processResults:function(e){return e.page=e.page||1,e},cache:!0}},e=c.extend(e,t);a.data("action")||delete e.ajax,a.closest(".eac-form").length&&(e.dropdownParent=a.closest(".eac-form")),a.select2(e).addClass("enhanced")}},tooltip:function(e,t={}){"undefined"==typeof c.tooltip?console.warn("jQuery UI is not loaded."):(e=c(e),t=c.extend({tooltipClass:"eac-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}},t),e.tooltip(t))},datepicker:function(e,t={}){if("undefined"==typeof c.datepicker)console.warn("jQuery UI Datepicker is not loaded.");else{const a=c(e);e=c.extend({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+0",showButtonPanel:!0,closeText:"Clear",onClose:function(e,t){c(n.event.srcElement).hasClass("ui-datepicker-close")&&a.val("")}},t);a.datepicker(e).addClass("enhanced")}},convertMoney:function(a,e,n){if(void 0!==e&&e||(e=o.fn.getVar("base_currency_code")),void 0!==n&&n||(n=o.fn.getVar("quote_currency_code")),a=o.fn.unFormatMoney(a,e),e===n)return a;o.api.getExchangeRate(e).then(t=>{o.api.getExchangeRate(n).then(e=>a/t*e)})}},api:{fetch:async function(e,t,a){a=a||"GET";e=o.vars.rest_url.replace(/\/+$/,"")+e;try{return await c.ajax({url:e,method:a,data:t,contentType:"application/json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",o.vars.rest_nonce)}})}catch(n){e=n?.responseJSON?.message||n?.statusText;throw new Error(e)}},getCurrency:async function(e){e=e||o.vars.base_currency_code;try{var t=o.fn.getCache(e,"currencies");if(t)return t;console.log("fetching because not cached"),console.log(e),console.log(o.cache.currencies);var a=await o.api.fetch("/eac/v1/currencies/"+e);return o.fn.setCache(e,a,"currencies"),a}catch(n){throw new Error(n)}},getBaseCurrency:async function(){return o.api.getCurrency()},getExchangeRate:async function(e){return(await o.api.getCurrency(e))?.exchange_rate||1},getAccount:async function(e){try{var t,a=o.fn.getCache(e,"accounts");return a?a:(t=await o.api.fetch("/eac/v1/accounts/"+e),o.fn.setCache(t.id,t,"accounts"),t)}catch(n){throw new Error(n)}},getCustomer:async function(e){try{var t,a=o.fn.getCache(e,"customers");return a?a:(t=await o.api.fetch("/eac/v1/customers/"+e),o.fn.setCache(t.id,t,"customers"),t)}catch(n){throw new Error(n)}},getVendor:async function(e){try{var t,a=o.fn.getCache(e,"vendors");return a?a:(t=await o.api.fetch("/eac/v1/vendors/"+e),o.fn.setCache(t.id,t,"vendors"),t)}catch(n){throw new Error(n)}}}};n.eac=n.eac||{},c.extend(n.eac,o)}(jQuery,window,document);