jQuery(function(t){t.fn.eaccounting_form=function(n){return this.each(function(){new t.eaccounting_form(this,n)})},t.eaccounting_form=function(n,e){this.form=n,this.$form=t(n),this.options=e;var o=this;return this.$account_select=t("#account_id, #from_account_id",this.$form),this.$currency_select=t("#currency_code",this.$form),this.$customer_select=t("#customer_id",this.$form),this.$vendor_select=t("#vendor_id",this.$form),this.$category_select=t("#category_id",this.$form),this.$amount_input=t("#amount, #opening_balance",this.$form),this.$currency_code_select=t("#code, #currency_code",this.$form),this.$uploader=t('[type="file"]',this.$form),this.$file_value=t(".ea-file-input",this.$form),this.$file_preview=t(".ea-file",this.$el),this.block=function(){this.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblock=function(){this.$form.unblock()},this.handle_error=function(n){console.warn(n),o.unblock(),t.eaccounting_notice(n,"error")},this.mask_input=function(n){o.$amount_input.inputmask("decimal",{alias:"numeric",groupSeparator:n.thousand_separator,autoGroup:!0,digits:n.precision,radixPoint:n.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:n.symbol,placeholder:"0.000",rightAlign:0})},this.get_account=function(n,e){wp.ajax.send("eaccounting_get_account",{data:{id:n,_wpnonce:eaccounting_form_i10n.nonce.get_account},success:e,error:o.handle_error})},this.get_currency=function(n,e){console.log("eaccounting_get_currency"),wp.ajax.send("eaccounting_get_currency",{data:{code:n,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:e,error:o.handle_error})},this.$account_select.on("change",function(){if(!o.$amount_input.length)return!1;var n=parseInt(o.$account_select.val(),10);if(!n)return!1;o.block();o.get_account(n,function(n){var e;e=n.currency_code,o.get_currency(e,function(n){o.mask_input(n),o.unblock()})})}),this.$currency_select.on("change",function(){if(!o.$amount_input.length)return!1;var n=o.$currency_select.val();if(!n)return!1;o.block(),o.get_currency(n,function(n){o.mask_input(n),o.unblock()})}),this.$currency_code_select.on("change",function(){var n=o.$currency_code_select.val();if(!n)return!1;try{var e=eaccounting_form_i10n.global_currencies[n];t("#precision",o.$form).val(e.precision).change(),t("#position",o.$form).val(e.position).change(),t("#symbol",o.$form).val(e.symbol).change(),t("#decimal_separator",o.$form).val(e.decimal_separator).change(),t("#thousand_separator",o.$form).val(e.thousand_separator).change()}catch(c){console.warn(c.message)}}),o.$uploader.on("change",function(n){var e=new FormData;e.append("nonce",o.$uploader.data("nonce")),e.append("upload",o.$uploader[0].files[0]),e.append("limit",o.$uploader.data("limit")),e.append("action","eaccounting_upload_files"),o.block(),window.wp.ajax.send({type:"POST",data:e,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(n){o.unblock(),o.$file_value.val(n.url),o.$file_preview.find(".ea-file-link").text(n.name).attr("href",n.url),o.$file_preview.show(),o.$uploader.hide()},error:function(n){o.handle_error(n)}})}),o.$form.find(".ea-file-delete").on("click",function(n){n.preventDefault(),o.$file_value.val(""),o.$file_preview.find(".ea-file-link").text("").attr("href",""),o.$file_preview.hide(),o.$uploader.show()}),this.$form.on("submit",function(n){n.preventDefault(),o.block(),wp.ajax.send({data:o.$form.serializeAssoc(),success:function(n){o.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),o.unblock(),t.eaccounting_notice(n.message,"error")}})}),this.init=function(){o.$account_select.length&&o.$account_select.trigger("change"),o.$currency_select.length&&o.$currency_select.trigger("change")},this.init(),this},t(document).ready(function(){t(".ea-ajax-form").eaccounting_form()});var o=function(n,e){n.inputmask("decimal",{alias:"numeric",groupSeparator:e.thousand_separator,autoGroup:!0,digits:e.precision,radixPoint:e.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:e.symbol,placeholder:"0.000",rightAlign:0})},e={init:function(){t("#ea-tax-form").on("change keyup",'input[name="rate"]',this.input_tax_rate).on("submit",this.submit),t(document).on("ready",function(){t('#ea-tax-form input[name="rate"]').trigger("change")})},block:function(){t("#ea-tax-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-tax-form").unblock()},input_tax_rate:function(n){n.target.value=n.target.value.replace(/[^0-9.]/g,"")},submit:function(n){n.preventDefault(),e.block(),wp.ajax.send({data:t("#ea-tax-form").serializeAssoc(),success:function(n){e.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),e.unblock(),t.eaccounting_notice(n.message,"error")}})}},a={init:function(){t("#ea-revenue-form").on("change","#account_id",this.update_amount_input).on("submit",this.submit),t(document).on("ready",function(){t("#ea-revenue-form #account_id").trigger("change")})},block:function(){t("#ea-revenue-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-revenue-form").unblock()},update_amount_input:function(n){var e=parseInt(n.target.value,10);if(!e)return!1;a.block();var c=t("#ea-revenue-form #amount");wp.ajax.send("eaccounting_get_account_currency",{data:{account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:function(n){o(c,n),a.unblock()},error:function(n){console.warn(n),a.unblock(),t.eaccounting_notice(n.message,"error")}})},submit:function(n){n.preventDefault(),a.block(),wp.ajax.send({data:t("#ea-revenue-form").serializeAssoc(),success:function(n){a.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),a.unblock(),t.eaccounting_notice(n.message,"error")}})}},c={init:function(){t("#ea-category-form").on("submit",this.submit)},block:function(){t("#ea-category-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-category-form").unblock()},submit:function(n){n.preventDefault(),c.block(),wp.ajax.send({data:t("#ea-category-form").serializeAssoc(),success:function(n){c.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),c.unblock(),t.eaccounting_notice(n.message,"error")}})}},r={init:function(){t("#ea-currency-form").on("change","#code",this.update_currency_fields).on("submit",this.submit)},block:function(){t("#ea-currency-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-currency-form").unblock()},update_currency_fields:function(n){var e=n.target.value;if(!e)return!1;var c=eaccounting_form_i10n.global_currencies[e];t("#name","#ea-currency-form").val(c.name).change(),t("#precision","#ea-currency-form").val(c.precision).change(),t("#position","#ea-currency-form").val(c.position).change(),t("#symbol","#ea-currency-form").val(c.symbol).change(),t("#decimal_separator","#ea-currency-form").val(c.decimal_separator).change(),t("#thousand_separator","#ea-currency-form").val(c.thousand_separator).change()},submit:function(n){n.preventDefault(),r.block(),wp.ajax.send({data:t("#ea-currency-form").serializeAssoc(),success:function(n){r.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),r.unblock(),t.eaccounting_notice(n.message,"error")}})}},i={init:function(){t("#ea-item-form").on("change keyup",'input[name="quantity"]',this.input_item_quantity).on("submit",this.submit)},block:function(){t("#ea-item-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-item-form").unblock()},input_item_quantity:function(n){n.target.value=n.target.value.replace(/[^0-9.]/g,"")},submit:function(n){n.preventDefault(),i.block(),wp.ajax.send({data:t("#ea-item-form").serializeAssoc(),success:function(n){i.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),i.unblock(),t.eaccounting_notice(n.message,"error")}})}},u={init:function(){t("#ea-account-form").on("change","#currency_code",this.update_opening_balance).on("submit",this.submit),t(document).on("ready",function(){t("#ea-account-form #currency_code").trigger("change")})},block:function(){t("#ea-account-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-account-form").unblock()},update_opening_balance:function(n){var e=n.target.value;if(!e)return!1;u.block();var c=t("#ea-account-form #opening_balance");wp.ajax.send("eaccounting_get_currency",{data:{code:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:function(n){o(c,n),u.unblock()},error:function(n){console.warn(n),u.unblock(),t.eaccounting_notice(n.message,"error")}})},submit:function(n){n.preventDefault(),u.block(),wp.ajax.send({data:t("#ea-account-form").serializeAssoc(),success:function(n){u.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),u.unblock(),t.eaccounting_notice(n.message,"error")}})}},s={init:function(){t("#ea-transfer-form").on("change","#from_account_id",this.update_amount_input).on("submit",this.submit),t(document).on("ready",function(){t("#ea-transfer-form #from_account_id").trigger("change")})},block:function(){t("#ea-transfer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){t("#ea-transfer-form").unblock()},update_amount_input:function(n){var e=parseInt(n.target.value,10);if(!e)return!1;s.block();var c=t("#ea-transfer-form #amount");wp.ajax.send("eaccounting_get_account_currency",{data:{account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:function(n){o(c,n),s.unblock()},error:function(n){console.warn(n),s.unblock(),t.eaccounting_notice(n.message,"error")}})},submit:function(n){n.preventDefault(),s.block(),wp.ajax.send({data:t("#ea-transfer-form").serializeAssoc(),success:function(n){s.unblock(),t.eaccounting_notice(n,"success"),t.eaccounting_redirect(n)},error:function(n){console.warn(n),s.unblock(),t.eaccounting_notice(n.message,"error")}})}};e.init(),a.init(),c.init(),r.init(),i.init(),u.init(),s.init()});