jQuery(function(i){"use strict";var n=function(e,n){i(e).inputmask("decimal",{alias:"numeric",groupSeparator:n.thousand_separator,autoGroup:!0,digits:n.precision,radixPoint:n.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:n.symbol,placeholder:"0.000",rightAlign:0,autoUnmask:!0})},t={init:function(){i(document).on("change",'#ea-revenue-form [name="account_id"]',this.update_amount_input).on("submit","#ea-revenue-form",this.submit)},block:function(){i("#ea-revenue-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-revenue-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;t.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};i.post(ajaxurl,e,function(e){e.success&&n(i('#ea-revenue-form [name="amount"]'),e.data)}).always(function(e){t.unblock(),i.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),t.block();e=i("#ea-revenue-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),t.unblock()})}},a={init:function(){i(document).on("change",'#ea-payment-form [name="account_id"]',this.update_amount_input).on("submit","#ea-payment-form",this.submit)},block:function(){i("#ea-payment-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-payment-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;a.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};i.post(ajaxurl,e,function(e){e.success&&n(i('#ea-payment-form [name="amount"]'),e.data)}).always(function(e){a.unblock(),i.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),a.block();e=i("#ea-payment-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),a.unblock()})}},o={init:function(){i("#ea-account-form").on("select2:select",'[name="currency_code"]',this.update_amount_input).on("submit",this.submit)},block:function(){i("#ea-account-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-account-form").unblock()},update_amount_input:function(e){e=e.params.data.id;if(!e)return!1;e=eaccounting_form_i10n.global_currencies[e];n(i('#ea-account-form [name="opening_balance"]'),e)},submit:function(e){e.preventDefault(),o.block();e=i("#ea-account-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),o.unblock()})}},c={init:function(){i("#ea-transfer-form").on("change",'[name="from_account_id"]',this.update_amount_input).find("#from_account_id").trigger("change").end().on("submit",this.submit)},block:function(){i("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-transfer-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;c.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};i.post(ajaxurl,e,function(e){e.success&&n(i('#ea-transfer-form [name="amount"]'),e.data)}).always(function(e){c.unblock(),i.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),c.block();e=i("#ea-transfer-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),c.unblock()})}},u={init:function(){i("#ea-customer-form").on("submit",this.submit)},block:function(){i("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-customer-form").unblock()},submit:function(e){e.preventDefault(),u.block();e=i("#ea-customer-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),u.unblock()})}},l={init:function(){i("#ea-vendor-form").on("submit",this.submit)},block:function(){i("#ea-vendor-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-vendor-form").unblock()},submit:function(e){e.preventDefault(),l.block();e=i("#ea-vendor-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),l.unblock()})}},r={init:function(){i("#ea-category-form").on("submit",this.submit)},block:function(){i("#ea-category-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-category-form").unblock()},submit:function(e){e.preventDefault(),r.block();e=i("#ea-category-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),r.unblock()})}},e={init:function(){i("#ea-item-form").on("submit",this.submit)},block:function(){i("#ea-item-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-item-form").unblock()},submit:function(e){e.preventDefault(),r.block();e=i("#ea-item-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),r.unblock()})}},s={init:function(){i("#ea-currency-form").on("change",'[name="code"]',this.update_currency_props).on("submit",this.submit)},block:function(){i("#ea-currency-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-currency-form").unblock()},update_currency_props:function(e){e=e.target.value;if(!e)return!1;e=eaccounting_form_i10n.global_currencies[e];i('[name="name"]',"#ea-currency-form").val(e.name).change(),i('[name="precision"]',"#ea-currency-form").val(e.precision).change(),i('[name="position"]',"#ea-currency-form").val(e.position).change(),i('[name="symbol"]',"#ea-currency-form").val(e.symbol).change(),i('[name="decimal_separator"]',"#ea-currency-form").val(e.decimal_separator).change(),i('[name="thousand_separator"]',"#ea-currency-form").val(e.thousand_separator).change()},submit:function(e){e.preventDefault(),s.block();e=i("#ea-currency-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),s.unblock()})}},m={init:function(){i("#ea-invoice-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),i("#ea-invoice").on("click",".delete_note",this.delete_note).on("click",".receive-payment",this.receive_payment),i(document).on("submit","#invoice-note-form",this.add_note),i(document.body).on("ea_invoice_updated",this.recalculate)},block:function(){i("#ea-invoice-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-invoice-form").unblock()},add_line_item:function(e){e.preventDefault();var n=i(i("#ea-invoice-line-template").html()),t=i(i("#ea-invoice-item-selector").html()),e=t.attr("name"),a=Array(1).fill(null).map(Math.random().toString(10).substr(2)).join("");n.addClass("editing"),i(n).find(":input").each(function(){var e=(e=i(this).attr("name")).replace(/\[(\d+)\]/,"["+a+"]");i(this).attr("name",e).attr("id",e)}),e=e.replace(/\[(\d+)\]/,"["+a+"]"),t.attr("name",e).attr("id",e),t.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(t),i("#ea-document__line-items").append(n),i(document.body).trigger("ea_select2_init")},item_selected:function(e){var n=e.params.data;i(e.target).closest("tr").find("input.line_item_price").val(n.item.sale_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.sales_tax),i("body").trigger("ea_invoice_updated")},remove_line_item:function(e){e.preventDefault(),i(this).closest("tr").remove(),m.recalculate()},edit_line_item:function(e){e.preventDefault();e=i(this).closest(".ea-document__line");if(e.hasClass("editing"))return e.removeClass("editing"),i("body").trigger("ea_invoice_updated"),!1;e.siblings("tr").removeClass("editing"),e.addClass("editing")},delete_note:function(e){e.preventDefault();var n=i(this).closest(".ea-document-notes__item"),e=n.data("nonce"),e={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:e};i.post(ajaxurl,e,function(e){e.success&&(n.remove(),i("#ea-invoice_notes-body").replaceWith(e.data.notes))}).always(function(e){i.eaccounting_notice(e)})},add_discount:function(e){i("#ea-modal-add-discount").ea_modal({onReady:function(e){i("#discount",e.$modal).val(i("#ea-invoice-form #discount").val()),i("#discount_type",e.$modal).val(i("#ea-invoice-form #discount_type").val())},onSubmit:function(e,n){i("#ea-invoice-form #discount").val(e.discount),i("#ea-invoice-form #discount_type").val(e.discount_type),n.close(),m.recalculate()}})},receive_payment:function(e){e.preventDefault();var e=i("#ea-modal-add-invoice-payment"),n=i(this).data("currency");e.ea_modal({onReady:function(e){eaccounting_mask_amount(i('[name="amount"]',e.$modal),n)},onSubmit:function(e,n){i.post(ajaxurl,e,function(e){}).always(function(e){n.close(),i.eaccounting_notice(e),location.reload()})}})},add_note:function(e){e.preventDefault();var n=i(this);eaccounting_block(n);e=n.serializeObject();i.post(ajaxurl,e,function(e){e.success&&i("#ea-invoice_notes-body").replaceWith(e.data.notes)}).always(function(e){i.eaccounting_notice(e),eaccounting_unblock(n),i("#invoice-note-form textarea").val("")})},recalculate:function(){m.block();var e=i.extend({},i("#ea-invoice-form").serializeObject(),{action:"eaccounting_invoice_recalculate"});i.post(ajaxurl,e,function(e){e.success?i("#ea-invoice-form .ea-document__items-wrapper").replaceWith(e.data.html):i.eaccounting_notice(e)}).always(function(e){m.unblock()})},submit:function(e){e.preventDefault(),m.block();e=i("#ea-invoice-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),m.unblock()})}},d={init:function(){i("#ea-bill-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),i("#ea-bill").on("click",".delete_note",this.delete_note).on("click",".add-payment",this.add_payment),i(document).on("submit","#bill-note-form",this.add_note),i(document.body).on("ea_bill_updated",this.recalculate)},block:function(){i("#ea-bill-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){i("#ea-bill-form").unblock()},add_line_item:function(e){e.preventDefault();var n=i(i("#ea-bill-line-template").html()),t=i(i("#ea-bill-item-selector").html()),e=t.attr("name"),a=Array(1).fill(null).map(Math.random().toString(10).substr(2)).join("");n.addClass("editing"),i(n).find(":input").each(function(){var e=(e=i(this).attr("name")).replace(/\[(\d+)\]/,"["+a+"]");i(this).attr("name",e).attr("id",e)}),e=e.replace(/\[(\d+)\]/,"["+a+"]"),t.attr("name",e).attr("id",e),t.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(t),i("#ea-document__line-items").append(n),i(document.body).trigger("ea_select2_init")},item_selected:function(e){var n=e.params.data;i(e.target).closest("tr").find("input.line_item_price").val(n.item.purchase_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.purchase_tax),i("body").trigger("ea_bill_updated")},remove_line_item:function(e){e.preventDefault(),i(this).closest("tr").remove(),d.recalculate()},edit_line_item:function(e){e.preventDefault();e=i(this).closest(".ea-document__line");if(e.hasClass("editing"))return e.removeClass("editing"),i("body").trigger("ea_bill_updated"),!1;e.siblings("tr").removeClass("editing"),e.addClass("editing")},delete_note:function(e){e.preventDefault();var n=i(this).closest(".ea-document-notes__item"),e=n.data("nonce"),e={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:e};i.post(ajaxurl,e,function(e){e.success&&(n.remove(),i("#ea-bill_notes-body").replaceWith(e.data.notes))}).always(function(e){i.eaccounting_notice(e)})},add_discount:function(e){i("#ea-modal-add-discount").ea_modal({onReady:function(e){i("#discount",e.$modal).val(i("#ea-bill-form #discount").val()),i("#discount_type",e.$modal).val(i("#ea-bill-form #discount_type").val())},onSubmit:function(e,n){i("#ea-bill-form #discount").val(e.discount),i("#ea-bill-form #discount_type").val(e.discount_type),n.close(),d.recalculate()}})},add_payment:function(e){e.preventDefault();var e=i("#ea-modal-add-bill-payment"),n=i(this).data("currency");e.ea_modal({onReady:function(e){eaccounting_mask_amount(i("#amount",e.$modal),n)},onSubmit:function(e,n){i.post(ajaxurl,e,function(e){}).always(function(e){n.close(),i.eaccounting_notice(e),location.reload()})}})},add_note:function(e){e.preventDefault();var n=i(this);eaccounting_block(n);e=n.serializeObject();i.post(ajaxurl,e,function(e){e.success&&i("#ea-bill_notes-body").replaceWith(e.data.notes)}).always(function(e){i.eaccounting_notice(e),eaccounting_unblock(n),i("#bill-note-form textarea").val("")})},recalculate:function(){d.block();var e=i.extend({},i("#ea-bill-form").serializeObject(),{action:"eaccounting_bill_recalculate"});i.post(ajaxurl,e,function(e){e.success?i("#ea-bill-form .ea-document__items-wrapper").replaceWith(e.data.html):i.eaccounting_notice(e)}).always(function(e){d.unblock()})},submit:function(e){e.preventDefault(),d.block();e=i("#ea-bill-form").serializeObject();i.post(ajaxurl,e,function(e){i.eaccounting_redirect(e)}).always(function(e){i.eaccounting_notice(e),d.unblock()})}};t.init(),a.init(),o.init(),c.init(),u.init(),l.init(),r.init(),s.init(),e.init(),m.init(),d.init()});