jQuery(function(o){o.fn.eaccounting_form=function(e){return this.each(function(){new o.eaccounting_form(this,e)})},o.eaccounting_form=function(e,n){this.form=e,this.$form=o(e),this.options=n;var t=this;return this.$account_select=o("#account_id, #from_account_id",this.$form),this.$currency_select=o("#currency_code",this.$form),this.$customer_select=o("#customer_id",this.$form),this.$vendor_select=o("#vendor_id",this.$form),this.$category_select=o("#category_id",this.$form),this.$amount_input=o("#amount, #opening_balance",this.$form),this.$currency_code_select=o("#code, #currency_code",this.$form),this.$uploader=o('[type="file"]',this.$form),this.$file_value=o(".ea-file-input",this.$form),this.$file_preview=o(".ea-file",this.$el),this.block=function(){this.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblock=function(){this.$form.unblock()},this.handle_error=function(e){console.warn(e),t.unblock(),o.eaccounting_notice(e,"error")},this.mask_input=function(e){t.$amount_input.inputmask("decimal",{alias:"numeric",groupSeparator:e.thousand_separator,autoGroup:!0,digits:e.precision,radixPoint:e.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:e.symbol,placeholder:"0.000",rightAlign:0})},this.get_account=function(e,n){wp.ajax.send("eaccounting_get_account",{data:{id:e,_wpnonce:eaccounting_form_i10n.nonce.get_account},success:n,error:t.handle_error})},this.get_currency=function(e,n){console.log("eaccounting_get_currency"),wp.ajax.send("eaccounting_get_currency",{data:{code:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:n,error:t.handle_error})},this.$account_select.on("change",function(){if(!t.$amount_input.length)return!1;var e=parseInt(t.$account_select.val(),10);if(!e)return!1;t.block();t.get_account(e,function(e){e=e.currency_code,t.get_currency(e,function(e){t.mask_input(e),t.unblock()})})}),this.$currency_select.on("change",function(){if(!t.$amount_input.length)return!1;var e=t.$currency_select.val();if(!e)return!1;t.block(),t.get_currency(e,function(e){t.mask_input(e),t.unblock()})}),this.$currency_code_select.on("change",function(){var e=t.$currency_code_select.val();if(!e)return!1;try{var n=eaccounting_form_i10n.global_currencies[e];o("#precision",t.$form).val(n.precision).change(),o("#position",t.$form).val(n.position).change(),o("#symbol",t.$form).val(n.symbol).change(),o("#decimal_separator",t.$form).val(n.decimal_separator).change(),o("#thousand_separator",t.$form).val(n.thousand_separator).change()}catch(c){console.warn(c.message)}}),t.$uploader.on("change",function(e){var n=new FormData;n.append("nonce",t.$uploader.data("nonce")),n.append("upload",t.$uploader[0].files[0]),n.append("limit",t.$uploader.data("limit")),n.append("action","eaccounting_upload_files"),t.block(),window.wp.ajax.send({type:"POST",data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(e){t.unblock(),t.$file_value.val(e.url),t.$file_preview.find(".ea-file-link").text(e.name).attr("href",e.url),t.$file_preview.show(),t.$uploader.hide()},error:function(e){t.handle_error(e)}})}),t.$form.find(".ea-file-delete").on("click",function(e){e.preventDefault(),t.$file_value.val(""),t.$file_preview.find(".ea-file-link").text("").attr("href",""),t.$file_preview.hide(),t.$uploader.show()}),this.$form.on("submit",function(e){e.preventDefault(),t.block(),wp.ajax.send({data:t.$form.serializeAssoc(),success:function(e){t.unblock(),o.eaccounting_notice(e,"success"),o.eaccounting_redirect(e)},error:function(e){console.warn(e),t.unblock(),o.eaccounting_notice(e.message,"error")}})}),this.init=function(){t.$account_select.length&&t.$account_select.trigger("change"),t.$currency_select.length&&t.$currency_select.trigger("change")},this.init(),this},o(document).ready(function(){o(".ea-ajax-form").eaccounting_form()})});