jQuery(function(o){o.fn.eaccounting_form=function(n){return this.each(function(){new o.eaccounting_form(this,n)})},o.eaccounting_form=function(n,e){this.form=n,this.$form=o(n),this.options=e;var t=this;return this.$account_select=o("#account_id, #from_account_id",this.$form),this.$currency_select=o("#currency_code",this.$form),this.$customer_select=o("#customer_id",this.$form),this.$vendor_select=o("#vendor_id",this.$form),this.$category_select=o("#category_id",this.$form),this.$amount_input=o("#amount, #opening_balance",this.$form),this.$currency_code_select=o("#code, #currency_code",this.$form),this.$uploader=o('[type="file"]',this.$form),this.$file_input=o(".ea-files-upload",this.$form),this.$file_preview=o(".ea-files-preview",this.$el),this.block=function(){this.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblock=function(){this.$form.unblock()},this.handle_error=function(n){console.warn(n),t.unblock(),o.eaccounting_notice(n,"error")},this.mask_input=function(n){t.$amount_input.inputmask("decimal",{alias:"numeric",groupSeparator:n.thousand_separator,autoGroup:!0,digits:n.precision,radixPoint:n.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:n.symbol,placeholder:"0.000",rightAlign:0})},this.get_account=function(n,e){wp.ajax.send("eaccounting_get_account",{data:{id:n,_wpnonce:eaccounting_form_i10n.nonce.get_account},success:e,error:t.handle_error})},this.get_currency=function(n,e){console.log("eaccounting_get_currency"),wp.ajax.send("eaccounting_get_currency",{data:{code:n,_wpnonce:eaccounting_form_i10n.nonce.get_currency},success:e,error:t.handle_error})},this.$account_select.on("change",function(){if(!t.$amount_input.length)return!1;var n=parseInt(t.$account_select.val(),10);if(!n)return!1;t.block();t.get_account(n,function(n){var e;e=n.currency_code,t.get_currency(e,function(n){t.mask_input(n),t.unblock()})})}),this.$currency_select.on("change",function(){if(!t.$amount_input.length)return!1;var n=t.$currency_select.val();if(!n)return!1;t.block(),t.get_currency(n,function(n){t.mask_input(n),t.unblock()})}),this.$currency_code_select.on("change",function(){var n=t.$currency_code_select.val();if(!n)return!1;try{var e=eaccounting_form_i10n.global_currencies[n];o("#precision",t.$form).val(e.precision).change(),o("#position",t.$form).val(e.position).change(),o("#symbol",t.$form).val(e.symbol).change(),o("#decimal_separator",t.$form).val(e.decimal_separator).change(),o("#thousand_separator",t.$form).val(e.thousand_separator).change()}catch(c){console.warn(c.message)}}),t.$uploader.on("change",function(n){console.log(n)}),this.$form.on("submit",function(n){n.preventDefault(),t.block(),wp.ajax.send({data:t.$form.serializeAssoc(),success:function(n){t.unblock(),o.eaccounting_notice(n,"success"),o.eaccounting_redirect(n)},error:function(n){console.warn(n),t.unblock(),o.eaccounting_notice(n.message,"error")}})}),this.init=function(){t.$account_select.length&&t.$account_select.trigger("change"),t.$currency_select.length&&t.$currency_select.trigger("change")},this.init(),this},o(document).ready(function(){o(".ea-ajax-form").eaccounting_form()})});