jQuery(function(a){"use strict";var n=function(e,n){a(e).inputmask("decimal",{alias:"numeric",groupSeparator:n.thousand_separator,autoGroup:!0,digits:n.precision,radixPoint:n.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:n.symbol,placeholder:"0.000",rightAlign:0,autoUnmask:!0})},t={init:function(){a(document).on("change",'#ea-revenue-form [name="account_id"]',this.update_amount_input).on("submit","#ea-revenue-form",this.submit)},block:function(){a("#ea-revenue-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-revenue-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;t.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};a.post(ajaxurl,e,function(e){e.success&&n(a('#ea-revenue-form [name="amount"]'),e.data)}).always(function(e){t.unblock(),a.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),t.block();e=a("#ea-revenue-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),t.unblock()})}},i={init:function(){a(document).on("change",'#ea-payment-form [name="account_id"]',this.update_amount_input).on("submit","#ea-payment-form",this.submit)},block:function(){a("#ea-payment-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-payment-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;i.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};a.post(ajaxurl,e,function(e){e.success&&n(a('#ea-payment-form [name="amount"]'),e.data)}).always(function(e){i.unblock(),a.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),i.block();e=a("#ea-payment-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),i.unblock()})}},o={init:function(){a("#ea-account-form").on("select2:select",'[name="currency_code"]',this.update_amount_input).on("submit",this.submit)},block:function(){a("#ea-account-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-account-form").unblock()},update_amount_input:function(e){e=e.params.data.id;if(!e)return!1;e=eaccounting_form_i10n.global_currencies[e];n(a('#ea-account-form [name="opening_balance"]'),e)},submit:function(e){e.preventDefault(),o.block();e=a("#ea-account-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),o.unblock()})}},c={init:function(){a("#ea-transfer-form").on("change",'[name="from_account_id"]',this.update_amount_input).find("#from_account_id").trigger("change").end().on("submit",this.submit)},block:function(){a("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-transfer-form").unblock()},update_amount_input:function(e){e=parseInt(e.target.value,10);if(isNaN(e))return!1;c.block();e={action:"eaccounting_get_account_currency",account_id:e,_wpnonce:eaccounting_form_i10n.nonce.get_currency};a.post(ajaxurl,e,function(e){e.success&&n(a('#ea-transfer-form [name="amount"]'),e.data)}).always(function(e){c.unblock(),a.eaccounting_notice(e)})},submit:function(e){e.preventDefault(),c.block();e=a("#ea-transfer-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),c.unblock()})}},u={init:function(){a("#ea-customer-form").on("submit",this.submit)},block:function(){a("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-customer-form").unblock()},submit:function(e){e.preventDefault(),u.block();e=a("#ea-customer-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),u.unblock()})}},l={init:function(){a("#ea-vendor-form").on("submit",this.submit)},block:function(){a("#ea-vendor-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-vendor-form").unblock()},submit:function(e){e.preventDefault(),l.block();e=a("#ea-vendor-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),l.unblock()})}},r={init:function(){a("#ea-category-form").on("submit",this.submit)},block:function(){a("#ea-category-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-category-form").unblock()},submit:function(e){e.preventDefault(),r.block();e=a("#ea-category-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),r.unblock()})}},e={init:function(){a("#ea-item-form").on("submit",this.submit)},block:function(){a("#ea-item-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-item-form").unblock()},submit:function(e){e.preventDefault(),r.block();e=a("#ea-item-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),r.unblock()})}},s={init:function(){a("#ea-currency-form").on("change",'[name="code"]',this.update_currency_props).on("submit",this.submit)},block:function(){a("#ea-currency-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-currency-form").unblock()},update_currency_props:function(e){e=e.target.value;if(!e)return!1;e=eaccounting_form_i10n.global_currencies[e];a('[name="name"]',"#ea-currency-form").val(e.name).change(),a('[name="precision"]',"#ea-currency-form").val(e.precision).change(),a('[name="position"]',"#ea-currency-form").val(e.position).change(),a('[name="symbol"]',"#ea-currency-form").val(e.symbol).change(),a('[name="decimal_separator"]',"#ea-currency-form").val(e.decimal_separator).change(),a('[name="thousand_separator"]',"#ea-currency-form").val(e.thousand_separator).change()},submit:function(e){e.preventDefault(),s.block();e=a("#ea-currency-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),s.unblock()})}},m={init:function(){a("#ea-invoice-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),a("#ea-invoice").on("click",".delete_note",this.delete_note).on("click",".receive-payment",this.receive_payment),a(document).on("submit","#invoice-note-form",this.add_note),a(document.body).on("ea_invoice_updated",this.recalculate)},block:function(){a("#ea-invoice-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-invoice-form").unblock()},add_line_item:function(e){e.preventDefault();var n=a(a("#ea-invoice-line-template").html()),t=a(a("#ea-invoice-item-selector").html()),e=t.attr("name"),i=Array(1).fill(null).map(function(){return Math.random().toString(10).substr(2)}).join("");n.addClass("editing"),a(n).find(":input").each(function(){var e=(e=a(this).attr("name")).replace(/\[(\d+)\]/,"["+i+"]");a(this).attr("name",e).attr("id",e)}),e=e.replace(/\[(\d+)\]/,"["+i+"]"),t.attr("name",e).attr("id",e),t.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(t),a("#ea-document__line-items").append(n),a(document.body).trigger("ea_select2_init")},item_selected:function(e){var n=e.params.data;a(e.target).closest("tr").find("input.line_item_price").val(n.item.sale_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.sales_tax),a("body").trigger("ea_invoice_updated")},remove_line_item:function(e){e.preventDefault(),a(this).closest("tr").remove(),m.recalculate()},edit_line_item:function(e){e.preventDefault();e=a(this).closest(".ea-document__line");if(e.hasClass("editing"))return e.removeClass("editing"),a("body").trigger("ea_invoice_updated"),!1;e.siblings("tr").removeClass("editing"),e.addClass("editing")},delete_note:function(e){e.preventDefault();var n=a(this).closest(".ea-document-notes__item"),e=n.data("nonce"),e={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:e};a.post(ajaxurl,e,function(e){e.success&&(n.remove(),a("#ea-invoice_notes-body").replaceWith(e.data.notes))}).always(function(e){a.eaccounting_notice(e)})},add_discount:function(e){a("#ea-modal-add-discount").ea_modal({onReady:function(e){a("#discount",e.$modal).val(a("#ea-invoice-form #discount").val()),a("#discount_type",e.$modal).val(a("#ea-invoice-form #discount_type").val())},onSubmit:function(e,n){a("#ea-invoice-form #discount").val(e.discount),a("#ea-invoice-form #discount_type").val(e.discount_type),n.close(),m.recalculate()}})},receive_payment:function(e){e.preventDefault();var e=a("#ea-modal-add-invoice-payment"),n=a(this).data("currency");e.ea_modal({onReady:function(e){eaccounting_mask_amount(a('[name="amount"]',e.$modal),n)},onSubmit:function(e,n){a.post(ajaxurl,e,function(e){}).always(function(e){n.close(),a.eaccounting_notice(e),location.reload()})}})},add_note:function(e){e.preventDefault();var n=a(this);eaccounting_block(n);e=n.serializeObject();a.post(ajaxurl,e,function(e){e.success&&a("#ea-invoice_notes-body").replaceWith(e.data.notes)}).always(function(e){a.eaccounting_notice(e),eaccounting_unblock(n),a("#invoice-note-form textarea").val("")})},recalculate:function(){m.block();var e=a.extend({},a("#ea-invoice-form").serializeObject(),{action:"eaccounting_invoice_recalculate"});a.post(ajaxurl,e,function(e){e.success?a("#ea-invoice-form .ea-document__items-wrapper").replaceWith(e.data.html):a.eaccounting_notice(e)}).always(function(e){m.unblock()})},submit:function(e){e.preventDefault(),m.block();e=a("#ea-invoice-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),m.unblock()})}},d={init:function(){a("#ea-bill-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),a("#ea-bill").on("click",".delete_note",this.delete_note).on("click",".add-payment",this.add_payment),a(document).on("submit","#bill-note-form",this.add_note),a(document.body).on("ea_bill_updated",this.recalculate)},block:function(){a("#ea-bill-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#ea-bill-form").unblock()},add_line_item:function(e){e.preventDefault();var n=a(a("#ea-bill-line-template").html()),t=a(a("#ea-bill-item-selector").html()),e=t.attr("name"),i=Array(1).fill(null).map(function(){return Math.random().toString(10).substr(2)}).join("");n.addClass("editing"),a(n).find(":input").each(function(){var e=(e=a(this).attr("name")).replace(/\[(\d+)\]/,"["+i+"]");a(this).attr("name",e).attr("id",e)}),e=e.replace(/\[(\d+)\]/,"["+i+"]"),t.attr("name",e).attr("id",e),t.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(t),a("#ea-document__line-items").append(n),a(document.body).trigger("ea_select2_init")},item_selected:function(e){var n=e.params.data;a(e.target).closest("tr").find("input.line_item_price").val(n.item.purchase_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.purchase_tax),a("body").trigger("ea_bill_updated")},remove_line_item:function(e){e.preventDefault(),a(this).closest("tr").remove(),d.recalculate()},edit_line_item:function(e){e.preventDefault();e=a(this).closest(".ea-document__line");if(e.hasClass("editing"))return e.removeClass("editing"),a("body").trigger("ea_bill_updated"),!1;e.siblings("tr").removeClass("editing"),e.addClass("editing")},delete_note:function(e){e.preventDefault();var n=a(this).closest(".ea-document-notes__item"),e=n.data("nonce"),e={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:e};a.post(ajaxurl,e,function(e){e.success&&(n.remove(),a("#ea-bill_notes-body").replaceWith(e.data.notes))}).always(function(e){a.eaccounting_notice(e)})},add_discount:function(e){a("#ea-modal-add-discount").ea_modal({onReady:function(e){a("#discount",e.$modal).val(a("#ea-bill-form #discount").val()),a("#discount_type",e.$modal).val(a("#ea-bill-form #discount_type").val())},onSubmit:function(e,n){a("#ea-bill-form #discount").val(e.discount),a("#ea-bill-form #discount_type").val(e.discount_type),n.close(),d.recalculate()}})},add_payment:function(e){e.preventDefault();var e=a("#ea-modal-add-bill-payment"),n=a(this).data("currency");e.ea_modal({onReady:function(e){eaccounting_mask_amount(a("#amount",e.$modal),n)},onSubmit:function(e,n){a.post(ajaxurl,e,function(e){}).always(function(e){n.close(),a.eaccounting_notice(e),location.reload()})}})},add_note:function(e){e.preventDefault();var n=a(this);eaccounting_block(n);e=n.serializeObject();a.post(ajaxurl,e,function(e){e.success&&a("#ea-bill_notes-body").replaceWith(e.data.notes)}).always(function(e){a.eaccounting_notice(e),eaccounting_unblock(n),a("#bill-note-form textarea").val("")})},recalculate:function(){d.block();var e=a.extend({},a("#ea-bill-form").serializeObject(),{action:"eaccounting_bill_recalculate"});a.post(ajaxurl,e,function(e){e.success?a("#ea-bill-form .ea-document__items-wrapper").replaceWith(e.data.html):a.eaccounting_notice(e)}).always(function(e){d.unblock()})},submit:function(e){e.preventDefault(),d.block();e=a("#ea-bill-form").serializeObject();a.post(ajaxurl,e,function(e){a.eaccounting_redirect(e)}).always(function(e){a.eaccounting_notice(e),d.unblock()})}};t.init(),i.init(),o.init(),c.init(),u.init(),l.init(),r.init(),s.init(),e.init(),m.init(),d.init()});