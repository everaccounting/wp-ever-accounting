!function(a,e,n){"use strict";a.fn.ea_backbone_modal=function(e){return this.each(function(){new a.ea_backbone_modal(a(this),e)})},a.ea_backbone_modal=function(e,t){var n=a.extend({},a.ea_backbone_modal.defaultOptions,t);n.template&&new a.ea_backbone_modal.View({target:n.template,string:n.variable,onSubmit:t.onSubmit,onReady:t.onReady})},a.ea_backbone_modal.defaultOptions={template:"",variable:{},onSubmit:undefined,onReady:undefined},a.ea_backbone_modal.View=e.View.extend({tagName:"div",id:"ea-backbone-modal-dialog",_target:undefined,_string:undefined,onSubmit:undefined,onReady:undefined,events:{"click .modal-close":"closeButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var e=a(".ea-backbone-modal-content").find("article"),t=.75*a(window).height();e.css({"max-height":t+"px"})},initialize:function(e){var t=this;this._target=e.target,this._string=e.string,this.onSubmit=e.onSubmit,this.onReady=e.onReady,n.bindAll(this,"render"),this.render(),a(window).resize(function(){t.resizeContent()})},render:function(){var e=wp.template(this._target);this.$el.append(e(this._string)),a(document.body).css({overflow:"hidden"}).append(this.$el).addClass("ea-modal-open"),this.resizeContent(),this.$(".ea-backbone-modal-content").attr("tabindex","0").focus(),a(document.body).trigger("init_tooltips"),a(document.body).trigger("ea_backbone_modal_loaded",this._target),a(document.body).trigger(this._target+"_loaded");var t=this;"function"==typeof this.onReady&&this.onReady(this.$el,this),"function"==typeof this.onSubmit&&this.$el.find("form").on("submit",function(e){e.preventDefault(),t.onSubmit(t.getFormData(),t)})},closeButton:function(e){e.preventDefault(),this.closeModal()},closeModal:function(){a(document.body).trigger("ea_backbone_modal_before_remove",this._target),this.undelegateEvents(),a(document).off("focusin"),a(document.body).css({overflow:"auto"}).removeClass("ea-modal-open"),this.remove(),a(document.body).trigger("ea_backbone_modal_removed",this._target)},getFormData:function(){var n={};return a.each(a("form",this.$el).serializeArray(),function(e,t){-1!==t.name.indexOf("[]")?(t.name=t.name.replace("[]",""),n[t.name]=a.makeArray(n[t.name]),n[t.name].push(t.value)):n[t.name]=t.value}),n},keyboardActions:function(e){var t=e.keyCode||e.which;13!==t||e.target.tagName&&("input"===e.target.tagName.toLowerCase()||"textarea"===e.target.tagName.toLowerCase())||this.addButton(e),27===t&&this.closeButton(e)},disableSubmit:function(){this.$el.find('*[type="submit"]').attr("disabled","disabled")},enableSubmit:function(){this.$el.find('*[type="submit"]').removeAttr("disabled")}})}(jQuery,Backbone,_);