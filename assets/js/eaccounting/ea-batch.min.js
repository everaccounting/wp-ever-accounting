!function(r){var e=Backbone.View.extend({el:".ea-batch-form",events:{submit:"onSubmit"},initialize:function(){this.submitBtn=r('input[type="submit"]',this.$el),this.confirmation=this.submitBtn.data("ays"),_.bindAll(this,"onSubmit","process_step")},onSubmit:function(e){var s;e.preventDefault(),this.submitBtn.hasClass("disabled")||this.confirmation!==undefined&&!confirm(this.confirmation)||(s={process_name:this.$el.data("process_name"),nonce:this.$el.data("nonce"),form:this.$el.serialize()},this.submitBtn.addClass("disabled"),this.submitBtn.parent().append('<span class="spinner is-active"></span>'),r(".ea-batch-progress",this.$el).remove(),this.$el.append('<div class="ea-batch-progress"><div></div></div>'),this.process_step(1,s,this))},process_step:function(e,s){var t=this,i=t.$el,n=i.find(".spinner"),a=i.find(".ea-batch-progress"),o=!0===i.data("dismiss-when-complete");wp.ajax.send("eaccounting_process_batch_request",{batch_id:s.process_name,nonce:s.nonce,form:s.form,step:e,data:s,success:function(e){e.done&&!1==o&&i.find(".button-disabled").removeClass("button-disabled"),this.$el.find(".ea-batch-progress div").animate({width:"10%"},50,function(){}),t.process_step(parseInt(e.step),s)},error:function(e){n.remove(),a.remove(),i.append(r('<div class="updated error"><p>'+e.message+"</p></div>")),t.submitBtn.removeClass("disabled")}})}});jQuery(document).ready(function(){new e})}(jQuery);