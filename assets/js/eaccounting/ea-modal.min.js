!function(i,e,n){"use strict";i.fn.ea_modal=function(e){return this.each(function(){new i.ea_modal(i(this),e)})},i.ea_modal=function(e,t){var n=i.extend({},i.ea_modal.defaultOptions,t);n.template&&new i.ea_modal.View({target:n.template,string:n.variable,onSubmit:t.onSubmit,onReady:t.onReady})},i.ea_modal.defaultOptions={template:"",variable:{},onSubmit:undefined,onReady:undefined},i.ea_modal.View=e.View.extend({tagName:"div",id:"ea-modal-dialog",_target:undefined,_string:undefined,onSubmit:undefined,onReady:undefined,events:{"click .modal-close":"closeButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var e=i(".ea-modal-content").find("article"),t=.75*i(window).height();e.css({"max-height":t+"px"})},initialize:function(e){var t=this;this._target=e.target,this._string=e.string,this.onSubmit=e.onSubmit,this.onReady=e.onReady,n.bindAll(this,"render"),this.render(),i(window).resize(function(){t.resizeContent()})},render:function(){var e=wp.template(this._target);this.$el.append(e(this._string)),i(document.body).css({overflow:"hidden"}).append(this.$el).addClass("ea-modal-open"),this.resizeContent(),this.$(".ea-modal-content").attr("tabindex","0").focus(),i(document.body).trigger("init_tooltips"),i(document.body).trigger("ea_modal_loaded",this._target),i(document.body).trigger(this._target+"_loaded");var t=this;"function"==typeof this.onReady&&this.onReady(this.$el,this),"function"==typeof this.onSubmit&&this.$el.find("form").on("submit",function(e){e.preventDefault(),t.onSubmit(t.getFormData(),t)})},closeButton:function(e){e.preventDefault(),this.closeModal()},closeModal:function(){i(document.body).trigger("ea_modal_before_remove",this._target),this.undelegateEvents(),i(document).off("focusin"),i(document.body).css({overflow:"auto"}).removeClass("ea-modal-open"),this.remove(),i(document.body).trigger("ea_modal_removed",this._target)},getFormData:function(){var n={};return i.each(i("form",this.$el).serializeArray(),function(e,t){-1!==t.name.indexOf("[]")?(t.name=t.name.replace("[]",""),n[t.name]=i.makeArray(n[t.name]),n[t.name].push(t.value)):n[t.name]=t.value}),n},keyboardActions:function(e){var t=e.keyCode||e.which;if(13===t&&this.$el.find("form").length)return e.preventDefault(),this.$el.find('[type="submit"]').trigger("click"),!1;27===t&&this.closeButton(e)},disableSubmit:function(){this.$el.find('*[type="submit"]').attr("disabled","disabled")},enableSubmit:function(){this.$el.find('*[type="submit"]').removeAttr("disabled")}})}(jQuery,Backbone,_);