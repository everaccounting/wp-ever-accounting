jQuery(function(a){"use strict";var n={title:!(a.fn.ea_modal=function(t){return this.each(function(){new a.ea_modal(this,a.extend({},a(this).data(),t))})}),onSubmit:!1,onReady:!1,submit:"Submit",url:!1};a.ea_modal=function(t,o){var e=this;this.template_id=t,this.modal_id=a(t).attr("id"),this.$template=a(t),this.options=a.extend({},n,o);o='<div class="ea-modal" tabindex="-1" role="document"><div class="ea-modal__content"><div class="ea-modal__inner"><header class="ea-modal__header"><h1 class="ea-modal__title">'+this.options.title+'&nbsp;</h1><button class="ea-modal__close dashicons">&nbsp;</button></header><div class="ea-modal__body">'+this.$template.html()+'</div><div class="ea-modal__footer"><button type="button" class="button button-secondary ea-modal__close">Cancel</button></div></div></div><div class="ea-modal__backdrop ea-modal__close">&nbsp;</div>';return this.$modal=a(o),this.$modal.find('form [type="submit"]').remove(),this.$modal.find("form").append('<input type="submit" value="submit" style="display: none;">'),this.$modal.find("form")&&this.options.submit&&((o=a('<button type="button" class="button button-primary">').html(this.options.submit)).on("click",function(){e.$modal.find('form [type="submit"]').trigger("click")}),this.$modal.find(".ea-modal__footer").append(o)),this.block=function(){a(".ea-modal__body",e.$modal).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a(".ea-modal__footer button",e.$modal).attr("disabled","disabled")},this.unblock=function(){a(".ea-modal__body",e.$modal).unblock(),a(".ea-modal__footer button",e.$modal).removeAttr("disabled")},this.delegate=function(){a(window).bind("resize",e.resize),a(document).bind("keydown",e.keyboard_events)},this.undelegate=function(){a(window).unbind("resize",e.resize),a(document).unbind("keydown",e.keyboard_events)},this.resize=function(){},a(".ea-modal__close",e.$modal).on("click",function(t){t.preventDefault(),e.close()}),this.keyboard_events=function(t){var o=t.keyCode||t.which;if(13===o&&e.$modal.find("form").length)return t.preventDefault(),e.$modal.find('[type="submit"]').trigger("click"),!1;27===o&&e.close()},this.close=function(){a(document.body).trigger("ea_modal_closed",[e]),a(document).off("focusin"),a(document.body).css({overflow:"auto"}).removeClass("ea-modal-open"),e.undelegate(),a(".ea-modal").remove(),a(document.body).trigger("ea_modal_removed",[e])},this.init=function(){a(document.body).css({overflow:"hidden"}).append(this.$modal).addClass("ea-modal-open"),a(".ea-modal-content",this.$modal).attr("tabindex","0").focus(),a(".ea-modal__content .ea-input-date").datepicker({dateFormat:"yy-mm-dd"}),this.delegate(),this.resize(),a(document.body).trigger("ea_modal_loaded",[e]),"function"==typeof this.options.onReady&&this.options.onReady(this),a("form",e.$modal).on("submit",function(t){t.preventDefault(),e.block();var o=a("form",e.$modal).serializeObject();if("function"==typeof e.options.onSubmit)return e.options.onSubmit(o,e);a("form #action",e.$modal).length?a.post(ajaxurl,o,function(t){a.eaccounting_notice(t),t.success&&(e.close(),a(document.body).trigger("ea_modal_form_submitted",[t,e,o]))}).always(function(t){e.unblock()}):a(document.body).trigger("ea_modal_form_submitted",[e,o])})},this.init(),this}});